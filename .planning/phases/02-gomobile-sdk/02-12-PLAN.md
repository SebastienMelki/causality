---
phase: 02-gomobile-sdk
plan: 12
type: execute
wave: 6
depends_on: ["02-08"]
files_modified:
  - sdk/android/settings.gradle.kts
  - sdk/android/examples/compose-example/build.gradle.kts
  - sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/MainActivity.kt
  - sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ExampleApplication.kt
  - sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/MainScreen.kt
  - sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/theme/Theme.kt
  - sdk/android/examples/compose-example/README.md
autonomous: true

must_haves:
  truths:
    - "Compose example app compiles and runs"
    - "Example demonstrates SDK initialization in Application class"
    - "Example demonstrates modern Compose patterns with LaunchedEffect"
    - "Example demonstrates all SDK features (track, identify, flush, reset)"
  artifacts:
    - path: "sdk/android/examples/compose-example"
      provides: "Jetpack Compose example project"
    - path: "sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ExampleApplication.kt"
      provides: "SDK initialization example"
      contains: "Causality.initialize"
    - path: "sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/MainScreen.kt"
      provides: "Compose UI with SDK usage"
      contains: "Causality.track"
  key_links:
    - from: "sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ExampleApplication.kt"
      to: "Causality"
      via: "SDK initialization"
      pattern: "Causality.initialize"
    - from: "sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/MainScreen.kt"
      to: "Causality"
      via: "Screen tracking with LaunchedEffect"
      pattern: "LaunchedEffect.*Causality"
---

<objective>
Create Jetpack Compose example application demonstrating SDK integration with modern Compose architecture.

Purpose: Example apps serve as integration tests and documentation. This Compose-based example covers modern Android development patterns including LaunchedEffect for screen tracking, coroutines for async operations, and Material 3 theming.

Output: `sdk/android/examples/compose-example/` project demonstrating SDK usage with Compose.
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-gomobile-sdk/02-CONTEXT.md
@.planning/phases/02-gomobile-sdk/02-08-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Jetpack Compose example application</name>
  <files>
    sdk/android/settings.gradle.kts
    sdk/android/examples/compose-example/build.gradle.kts
    sdk/android/examples/compose-example/src/main/AndroidManifest.xml
    sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ExampleApplication.kt
    sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/MainActivity.kt
    sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/MainScreen.kt
    sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/theme/Theme.kt
    sdk/android/examples/compose-example/README.md
  </files>
  <action>
Update **sdk/android/settings.gradle.kts** to include Compose example (add to existing):
```kotlin
rootProject.name = "causality-android-sdk"

include(":causality")
include(":examples:views-example")
include(":examples:compose-example")
```

**sdk/android/examples/compose-example/build.gradle.kts:**
```kotlin
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
}

android {
    namespace = "io.causality.example.compose"
    compileSdk = 34

    defaultConfig {
        applicationId = "io.causality.example.compose"
        minSdk = 24  // Compose requires API 24+
        targetSdk = 34
        versionCode = 1
        versionName = "1.0"
    }

    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }

    buildFeatures {
        compose = true
    }

    composeOptions {
        kotlinCompilerExtensionVersion = "1.5.8"
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = "17"
    }
}

dependencies {
    implementation(project(":causality"))

    // Compose
    implementation(platform("androidx.compose:compose-bom:2024.01.00"))
    implementation("androidx.compose.ui:ui")
    implementation("androidx.compose.ui:ui-graphics")
    implementation("androidx.compose.ui:ui-tooling-preview")
    implementation("androidx.compose.material3:material3")
    implementation("androidx.activity:activity-compose:1.8.2")
    implementation("androidx.lifecycle:lifecycle-runtime-compose:2.7.0")

    // Coroutines
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3")

    debugImplementation("androidx.compose.ui:ui-tooling")
}
```

**sdk/android/examples/compose-example/src/main/AndroidManifest.xml:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">

    <uses-permission android:name="android.permission.INTERNET" />

    <application
        android:name=".ExampleApplication"
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="Causality Compose Example"
        android:theme="@android:style/Theme.Material.Light.NoActionBar">

        <activity
            android:name=".MainActivity"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>
```

**sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ExampleApplication.kt:**
```kotlin
package io.causality.example.compose

import android.app.Application
import android.util.Log
import io.causality.Causality

class ExampleApplication : Application() {
    override fun onCreate() {
        super.onCreate()

        try {
            Causality.initialize(this) {
                apiKey = "your-api-key"
                endpoint = "http://10.0.2.2:8080"
                appId = "compose-example"
                debugMode = true
            }
            Log.d(TAG, "Causality SDK initialized")
            Log.d(TAG, "Device ID: ${Causality.deviceId}")
        } catch (e: Exception) {
            Log.e(TAG, "Failed to initialize Causality", e)
        }
    }

    companion object {
        private const val TAG = "ComposeExample"
    }
}
```

**sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/MainActivity.kt:**
```kotlin
package io.causality.example.compose

import android.os.Bundle
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import io.causality.example.compose.ui.MainScreen
import io.causality.example.compose.ui.theme.CausalityTheme

class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            CausalityTheme {
                MainScreen()
            }
        }
    }
}
```

**sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/MainScreen.kt:**
```kotlin
package io.causality.example.compose.ui

import android.util.Log
import androidx.compose.foundation.layout.*
import androidx.compose.material3.*
import androidx.compose.runtime.*
import androidx.compose.ui.Alignment
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import io.causality.Causality
import io.causality.event
import kotlinx.coroutines.launch

private const val TAG = "ComposeExample"

@OptIn(ExperimentalMaterial3Api::class)
@Composable
fun MainScreen() {
    val snackbarHostState = remember { SnackbarHostState() }
    val scope = rememberCoroutineScope()
    var isLoading by remember { mutableStateOf(false) }

    // Track screen view using LaunchedEffect (Compose pattern)
    LaunchedEffect(Unit) {
        Causality.trackScreenView("main_screen")
        Log.d(TAG, "Screen view tracked: main_screen")
    }

    Scaffold(
        snackbarHost = { SnackbarHost(snackbarHostState) },
        topBar = {
            TopAppBar(
                title = { Text("Causality Compose") }
            )
        }
    ) { padding ->
        Column(
            modifier = Modifier
                .fillMaxSize()
                .padding(padding)
                .padding(24.dp),
            horizontalAlignment = Alignment.CenterHorizontally,
            verticalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            // Device ID
            Text(
                text = "Device ID: ${Causality.deviceId}",
                style = MaterialTheme.typography.labelSmall,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )

            Spacer(modifier = Modifier.height(16.dp))

            // Track Event Button
            Button(
                onClick = {
                    Causality.track("button_tap") {
                        property("button_name", "track_event")
                        property("screen", "main_screen")
                    }
                    Log.d(TAG, "Event tracked: button_tap")
                    scope.launch { snackbarHostState.showSnackbar("Event tracked!") }
                },
                modifier = Modifier.fillMaxWidth()
            ) {
                Text("Track Event")
            }

            // Track Purchase Button
            Button(
                onClick = {
                    val purchaseEvent = event("purchase") {
                        property("product_id", "compose-premium")
                        property("price", 19.99)
                        property("currency", "USD")
                    }
                    Causality.track(purchaseEvent)
                    Log.d(TAG, "Event tracked: purchase")
                    scope.launch { snackbarHostState.showSnackbar("Purchase tracked!") }
                },
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.secondary
                ),
                modifier = Modifier.fillMaxWidth()
            ) {
                Text("Track Purchase")
            }

            // Identify User Button
            Button(
                onClick = {
                    try {
                        Causality.identify(
                            userId = "compose-user-101",
                            traits = mapOf(
                                "name" to "Compose Developer",
                                "plan" to "enterprise"
                            )
                        )
                        Log.d(TAG, "User identified")
                        scope.launch { snackbarHostState.showSnackbar("User identified!") }
                    } catch (e: Exception) {
                        Log.e(TAG, "Identify error", e)
                        scope.launch { snackbarHostState.showSnackbar("Error: ${e.message}") }
                    }
                },
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.tertiary
                ),
                modifier = Modifier.fillMaxWidth()
            ) {
                Text("Identify User")
            }

            // Flush Button
            Button(
                onClick = {
                    isLoading = true
                    scope.launch {
                        try {
                            Causality.flush()
                            Log.d(TAG, "Events flushed")
                            snackbarHostState.showSnackbar("Events flushed!")
                        } catch (e: Exception) {
                            Log.e(TAG, "Flush error", e)
                            snackbarHostState.showSnackbar("Error: ${e.message}")
                        } finally {
                            isLoading = false
                        }
                    }
                },
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.primaryContainer,
                    contentColor = MaterialTheme.colorScheme.onPrimaryContainer
                ),
                enabled = !isLoading,
                modifier = Modifier.fillMaxWidth()
            ) {
                if (isLoading) {
                    CircularProgressIndicator(
                        modifier = Modifier.size(24.dp),
                        color = MaterialTheme.colorScheme.onPrimaryContainer
                    )
                } else {
                    Text("Flush Events")
                }
            }

            // Reset Button
            Button(
                onClick = {
                    try {
                        Causality.reset()
                        Log.d(TAG, "User reset")
                        scope.launch { snackbarHostState.showSnackbar("User reset!") }
                    } catch (e: Exception) {
                        Log.e(TAG, "Reset error", e)
                        scope.launch { snackbarHostState.showSnackbar("Error: ${e.message}") }
                    }
                },
                colors = ButtonDefaults.buttonColors(
                    containerColor = MaterialTheme.colorScheme.error
                ),
                modifier = Modifier.fillMaxWidth()
            ) {
                Text("Reset User")
            }
        }
    }
}
```

**sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/theme/Theme.kt:**
```kotlin
package io.causality.example.compose.ui.theme

import android.os.Build
import androidx.compose.foundation.isSystemInDarkTheme
import androidx.compose.material3.*
import androidx.compose.runtime.Composable
import androidx.compose.ui.platform.LocalContext

@Composable
fun CausalityTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    dynamicColor: Boolean = true,
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            val context = LocalContext.current
            if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)
        }
        darkTheme -> darkColorScheme()
        else -> lightColorScheme()
    }

    MaterialTheme(
        colorScheme = colorScheme,
        content = content
    )
}
```

**sdk/android/examples/compose-example/README.md:**
```markdown
# Causality Jetpack Compose Example

This example demonstrates integrating the Causality SDK with a modern Jetpack Compose app.

## Setup

1. Build the AAR:
   ```bash
   make mobile-android
   ```

2. Open the project in Android Studio:
   ```bash
   cd sdk/android
   # Open in Android Studio
   ```

3. Update the API key and endpoint in `ExampleApplication.kt`

4. Run on emulator or device (requires API 24+)

## Features Demonstrated

- SDK initialization in Application class
- Screen view tracking with LaunchedEffect
- Event tracking with Kotlin DSL
- User identification
- Coroutine-based flush with loading state
- Material 3 theming
- Snackbar feedback

## Compose Patterns

### Track on Screen Appear
```kotlin
LaunchedEffect(Unit) {
    Causality.trackScreenView("home")
}
```

### Event Tracking with DSL
```kotlin
Causality.track("button_tap") {
    property("button_name", "checkout")
}
```

### Async Flush with State
```kotlin
var isLoading by remember { mutableStateOf(false) }
scope.launch {
    isLoading = true
    try {
        Causality.flush()
    } finally {
        isLoading = false
    }
}
```
```
  </action>
  <verify>
    - Directory exists: `ls sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/`
    - UI directory exists: `ls sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/`
    - Settings updated: `grep "compose-example" sdk/android/settings.gradle.kts`
  </verify>
  <done>
    - Compose example with Material 3 theming
    - MainScreen with modern Compose patterns
    - LaunchedEffect for screen tracking
    - Coroutine scope for async operations
    - Loading state for flush button
    - README with setup instructions
  </done>
</task>

</tasks>

<verification>
- Compose example: `ls sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/`
- UI directory: `ls sdk/android/examples/compose-example/src/main/kotlin/io/causality/example/compose/ui/`
- Settings updated: `grep "compose-example" sdk/android/settings.gradle.kts`
- (Full build requires AAR from gomobile)
</verification>

<success_criteria>
- Compose example demonstrates Application initialization
- Compose example uses modern Compose patterns (LaunchedEffect, rememberCoroutineScope)
- Example shows event tracking, identification, flush, reset
- Material 3 theming implemented
- README has setup instructions
</success_criteria>

<output>
After completion, create `.planning/phases/02-gomobile-sdk/02-12-SUMMARY.md`
</output>
