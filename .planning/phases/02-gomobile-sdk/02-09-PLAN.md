---
phase: 02-gomobile-sdk
plan: 09
type: execute
wave: 6
depends_on: ["02-07"]
files_modified:
  - sdk/ios/Examples/UIKitExample/UIKitExample.xcodeproj/project.pbxproj
  - sdk/ios/Examples/UIKitExample/UIKitExample/AppDelegate.swift
  - sdk/ios/Examples/UIKitExample/UIKitExample/ViewController.swift
  - sdk/ios/Examples/SwiftUIExample/SwiftUIExample.xcodeproj/project.pbxproj
  - sdk/ios/Examples/SwiftUIExample/SwiftUIExample/SwiftUIExampleApp.swift
  - sdk/ios/Examples/SwiftUIExample/SwiftUIExample/ContentView.swift
autonomous: true

must_haves:
  truths:
    - "UIKit example app compiles and runs"
    - "SwiftUI example app compiles and runs"
    - "Both examples demonstrate SDK initialization"
    - "Both examples demonstrate event tracking"
  artifacts:
    - path: "sdk/ios/Examples/UIKitExample"
      provides: "UIKit example project"
    - path: "sdk/ios/Examples/SwiftUIExample"
      provides: "SwiftUI example project"
  key_links:
    - from: "sdk/ios/Examples/UIKitExample/UIKitExample/AppDelegate.swift"
      to: "Causality"
      via: "SDK initialization"
      pattern: "Causality.shared.initialize"
    - from: "sdk/ios/Examples/SwiftUIExample/SwiftUIExample/SwiftUIExampleApp.swift"
      to: "Causality"
      via: "SDK initialization"
      pattern: "Causality.shared.initialize"
---

<objective>
Create iOS example applications demonstrating SDK integration with UIKit and SwiftUI.

Purpose: Example apps serve as integration tests and documentation. Developers can reference these to understand proper SDK usage patterns. Having both UIKit and SwiftUI examples covers the full iOS development spectrum.

Output: `sdk/ios/Examples/` with UIKitExample and SwiftUIExample projects.
</objective>

<execution_context>
@/Users/sebastienmelki/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sebastienmelki/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-gomobile-sdk/02-CONTEXT.md
@.planning/phases/02-gomobile-sdk/02-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create UIKit example application</name>
  <files>
    sdk/ios/Examples/UIKitExample/UIKitExample/AppDelegate.swift
    sdk/ios/Examples/UIKitExample/UIKitExample/SceneDelegate.swift
    sdk/ios/Examples/UIKitExample/UIKitExample/ViewController.swift
    sdk/ios/Examples/UIKitExample/UIKitExample/Info.plist
    sdk/ios/Examples/UIKitExample/Package.swift
    sdk/ios/Examples/UIKitExample/README.md
  </files>
  <action>
**sdk/ios/Examples/UIKitExample/Package.swift:**
```swift
// swift-tools-version:5.9

import PackageDescription

let package = Package(
    name: "UIKitExample",
    platforms: [.iOS(.v14)],
    dependencies: [
        .package(path: "../..")  // Points to sdk/ios
    ],
    targets: [
        .executableTarget(
            name: "UIKitExample",
            dependencies: [
                .product(name: "Causality", package: "Causality")
            ],
            path: "UIKitExample"
        )
    ]
)
```

**sdk/ios/Examples/UIKitExample/UIKitExample/AppDelegate.swift:**
```swift
import UIKit
import Causality

@main
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(
        _ application: UIApplication,
        didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
    ) -> Bool {

        // Initialize Causality SDK
        do {
            try Causality.shared.initialize(config: Config(
                apiKey: "your-api-key",  // Replace with actual key
                endpoint: "http://localhost:8080",  // Replace with server URL
                appId: "uikit-example",
                debugMode: true
            ))
            print("[UIKitExample] Causality SDK initialized")
            print("[UIKitExample] Device ID: \(Causality.shared.deviceId)")
        } catch {
            print("[UIKitExample] Failed to initialize: \(error)")
        }

        return true
    }

    // MARK: UISceneSession Lifecycle

    func application(
        _ application: UIApplication,
        configurationForConnecting connectingSceneSession: UISceneSession,
        options: UIScene.ConnectionOptions
    ) -> UISceneConfiguration {
        return UISceneConfiguration(name: "Default Configuration", sessionRole: connectingSceneSession.role)
    }
}
```

**sdk/ios/Examples/UIKitExample/UIKitExample/SceneDelegate.swift:**
```swift
import UIKit

class SceneDelegate: UIResponder, UIWindowSceneDelegate {

    var window: UIWindow?

    func scene(
        _ scene: UIScene,
        willConnectTo session: UISceneSession,
        options connectionOptions: UIScene.ConnectionOptions
    ) {
        guard let windowScene = (scene as? UIWindowScene) else { return }

        window = UIWindow(windowScene: windowScene)
        window?.rootViewController = UINavigationController(rootViewController: ViewController())
        window?.makeKeyAndVisible()
    }
}
```

**sdk/ios/Examples/UIKitExample/UIKitExample/ViewController.swift:**
```swift
import UIKit
import Causality

class ViewController: UIViewController {

    private let stackView: UIStackView = {
        let stack = UIStackView()
        stack.axis = .vertical
        stack.spacing = 16
        stack.translatesAutoresizingMaskIntoConstraints = false
        return stack
    }()

    private let deviceIdLabel: UILabel = {
        let label = UILabel()
        label.textAlignment = .center
        label.numberOfLines = 0
        label.font = .systemFont(ofSize: 12, weight: .medium)
        label.textColor = .secondaryLabel
        return label
    }()

    override func viewDidLoad() {
        super.viewDidLoad()

        title = "Causality UIKit Example"
        view.backgroundColor = .systemBackground

        setupUI()
        trackScreenView()
        updateDeviceIdLabel()
    }

    private func setupUI() {
        view.addSubview(stackView)
        NSLayoutConstraint.activate([
            stackView.centerXAnchor.constraint(equalTo: view.centerXAnchor),
            stackView.centerYAnchor.constraint(equalTo: view.centerYAnchor),
            stackView.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 20),
            stackView.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -20)
        ])

        // Device ID label
        stackView.addArrangedSubview(deviceIdLabel)

        // Track Button
        let trackButton = createButton(title: "Track Event", action: #selector(trackButtonTapped))
        stackView.addArrangedSubview(trackButton)

        // Identify Button
        let identifyButton = createButton(title: "Identify User", action: #selector(identifyTapped))
        stackView.addArrangedSubview(identifyButton)

        // Flush Button
        let flushButton = createButton(title: "Flush Events", action: #selector(flushTapped))
        stackView.addArrangedSubview(flushButton)

        // Reset Button
        let resetButton = createButton(title: "Reset User", action: #selector(resetTapped))
        resetButton.backgroundColor = .systemOrange
        stackView.addArrangedSubview(resetButton)
    }

    private func createButton(title: String, action: Selector) -> UIButton {
        let button = UIButton(type: .system)
        button.setTitle(title, for: .normal)
        button.backgroundColor = .systemBlue
        button.setTitleColor(.white, for: .normal)
        button.layer.cornerRadius = 8
        button.heightAnchor.constraint(equalToConstant: 44).isActive = true
        button.addTarget(self, action: action, for: .touchUpInside)
        return button
    }

    private func updateDeviceIdLabel() {
        deviceIdLabel.text = "Device ID: \(Causality.shared.deviceId)"
    }

    private func trackScreenView() {
        Causality.shared.trackScreenView(name: "main_screen")
    }

    @objc private func trackButtonTapped() {
        // Track using builder pattern
        let event = EventBuilder(type: "button_tap")
            .property("button_name", "track_event")
            .property("screen", "main_screen")
            .property("tap_count", 1)
            .build()

        Causality.shared.track(event)
        print("[UIKitExample] Event tracked: button_tap")

        // Visual feedback
        showToast(message: "Event tracked!")
    }

    @objc private func identifyTapped() {
        do {
            try Causality.shared.identify(
                userId: "user-123",
                traits: [
                    "name": AnyCodable("John Doe"),
                    "email": AnyCodable("john@example.com"),
                    "plan": AnyCodable("premium")
                ]
            )
            print("[UIKitExample] User identified: user-123")
            showToast(message: "User identified!")
        } catch {
            print("[UIKitExample] Identify error: \(error)")
            showToast(message: "Error: \(error.localizedDescription)")
        }
    }

    @objc private func flushTapped() {
        Task {
            do {
                try await Causality.shared.flush()
                print("[UIKitExample] Events flushed")
                await MainActor.run {
                    showToast(message: "Events flushed!")
                }
            } catch {
                print("[UIKitExample] Flush error: \(error)")
                await MainActor.run {
                    showToast(message: "Error: \(error.localizedDescription)")
                }
            }
        }
    }

    @objc private func resetTapped() {
        do {
            try Causality.shared.reset()
            print("[UIKitExample] User reset")
            showToast(message: "User reset!")
        } catch {
            print("[UIKitExample] Reset error: \(error)")
            showToast(message: "Error: \(error.localizedDescription)")
        }
    }

    private func showToast(message: String) {
        let alert = UIAlertController(title: nil, message: message, preferredStyle: .alert)
        present(alert, animated: true)
        DispatchQueue.main.asyncAfter(deadline: .now() + 1.5) {
            alert.dismiss(animated: true)
        }
    }
}
```

**sdk/ios/Examples/UIKitExample/UIKitExample/Info.plist:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>UIApplicationSceneManifest</key>
    <dict>
        <key>UIApplicationSupportsMultipleScenes</key>
        <false/>
        <key>UISceneConfigurations</key>
        <dict>
            <key>UIWindowSceneSessionRoleApplication</key>
            <array>
                <dict>
                    <key>UISceneConfigurationName</key>
                    <string>Default Configuration</string>
                    <key>UISceneDelegateClassName</key>
                    <string>$(PRODUCT_MODULE_NAME).SceneDelegate</string>
                </dict>
            </array>
        </dict>
    </dict>
    <key>NSAppTransportSecurity</key>
    <dict>
        <key>NSAllowsLocalNetworking</key>
        <true/>
    </dict>
</dict>
</plist>
```

**sdk/ios/Examples/UIKitExample/README.md:**
```markdown
# Causality UIKit Example

This example demonstrates integrating the Causality SDK with a UIKit-based iOS app.

## Setup

1. Build the XCFramework:
   ```bash
   make mobile-ios
   ```

2. Open in Xcode or build with Swift Package Manager:
   ```bash
   cd sdk/ios/Examples/UIKitExample
   swift build
   ```

3. Update the API key and endpoint in `AppDelegate.swift`

## Features Demonstrated

- SDK initialization in AppDelegate
- Screen view tracking
- Button tap tracking with properties
- User identification
- Manual event flush
- User reset

## Code Patterns

### Initialization
```swift
try Causality.shared.initialize(config: Config(
    apiKey: "your-api-key",
    endpoint: "https://your-server.com",
    appId: "your-app-id"
))
```

### Event Tracking
```swift
// Using builder
let event = EventBuilder(type: "button_tap")
    .property("button_name", "checkout")
    .build()
Causality.shared.track(event)

// Using convenience method
Causality.shared.trackScreenView(name: "home")
```

### User Identification
```swift
try Causality.shared.identify(
    userId: "user-123",
    traits: ["email": AnyCodable("user@example.com")]
)
```
```
  </action>
  <verify>
    - Directory exists: `ls sdk/ios/Examples/UIKitExample/UIKitExample/`
    - README exists: `cat sdk/ios/Examples/UIKitExample/README.md`
  </verify>
  <done>
    - UIKit example with AppDelegate initialization
    - ViewController with event tracking buttons
    - Demonstrates all SDK features
    - README with setup instructions
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SwiftUI example application</name>
  <files>
    sdk/ios/Examples/SwiftUIExample/SwiftUIExample/SwiftUIExampleApp.swift
    sdk/ios/Examples/SwiftUIExample/SwiftUIExample/ContentView.swift
    sdk/ios/Examples/SwiftUIExample/SwiftUIExample/Info.plist
    sdk/ios/Examples/SwiftUIExample/Package.swift
    sdk/ios/Examples/SwiftUIExample/README.md
  </files>
  <action>
**sdk/ios/Examples/SwiftUIExample/Package.swift:**
```swift
// swift-tools-version:5.9

import PackageDescription

let package = Package(
    name: "SwiftUIExample",
    platforms: [.iOS(.v14)],
    dependencies: [
        .package(path: "../..")  // Points to sdk/ios
    ],
    targets: [
        .executableTarget(
            name: "SwiftUIExample",
            dependencies: [
                .product(name: "Causality", package: "Causality")
            ],
            path: "SwiftUIExample"
        )
    ]
)
```

**sdk/ios/Examples/SwiftUIExample/SwiftUIExample/SwiftUIExampleApp.swift:**
```swift
import SwiftUI
import Causality

@main
struct SwiftUIExampleApp: App {

    init() {
        // Initialize Causality SDK
        do {
            try Causality.shared.initialize(config: Config(
                apiKey: "your-api-key",  // Replace with actual key
                endpoint: "http://localhost:8080",  // Replace with server URL
                appId: "swiftui-example",
                debugMode: true
            ))
            print("[SwiftUIExample] Causality SDK initialized")
            print("[SwiftUIExample] Device ID: \(Causality.shared.deviceId)")
        } catch {
            print("[SwiftUIExample] Failed to initialize: \(error)")
        }
    }

    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

**sdk/ios/Examples/SwiftUIExample/SwiftUIExample/ContentView.swift:**
```swift
import SwiftUI
import Causality

struct ContentView: View {
    @State private var showToast = false
    @State private var toastMessage = ""
    @State private var isLoading = false

    var body: some View {
        NavigationView {
            VStack(spacing: 20) {
                // Device ID
                Text("Device ID:")
                    .font(.caption)
                    .foregroundColor(.secondary)
                Text(Causality.shared.deviceId)
                    .font(.system(.caption, design: .monospaced))
                    .foregroundColor(.secondary)
                    .padding(.bottom, 20)

                // Track Event Button
                Button(action: trackEvent) {
                    HStack {
                        Image(systemName: "bolt.fill")
                        Text("Track Event")
                    }
                    .frame(maxWidth: .infinity)
                    .padding()
                    .background(Color.blue)
                    .foregroundColor(.white)
                    .cornerRadius(10)
                }

                // Track Purchase Button
                Button(action: trackPurchase) {
                    HStack {
                        Image(systemName: "cart.fill")
                        Text("Track Purchase")
                    }
                    .frame(maxWidth: .infinity)
                    .padding()
                    .background(Color.green)
                    .foregroundColor(.white)
                    .cornerRadius(10)
                }

                // Identify User Button
                Button(action: identifyUser) {
                    HStack {
                        Image(systemName: "person.fill")
                        Text("Identify User")
                    }
                    .frame(maxWidth: .infinity)
                    .padding()
                    .background(Color.purple)
                    .foregroundColor(.white)
                    .cornerRadius(10)
                }

                // Flush Button
                Button(action: flushEvents) {
                    HStack {
                        if isLoading {
                            ProgressView()
                                .progressViewStyle(CircularProgressViewStyle(tint: .white))
                        } else {
                            Image(systemName: "arrow.up.circle.fill")
                        }
                        Text("Flush Events")
                    }
                    .frame(maxWidth: .infinity)
                    .padding()
                    .background(Color.orange)
                    .foregroundColor(.white)
                    .cornerRadius(10)
                }
                .disabled(isLoading)

                // Reset Button
                Button(action: resetUser) {
                    HStack {
                        Image(systemName: "arrow.counterclockwise")
                        Text("Reset User")
                    }
                    .frame(maxWidth: .infinity)
                    .padding()
                    .background(Color.red)
                    .foregroundColor(.white)
                    .cornerRadius(10)
                }

                Spacer()
            }
            .padding()
            .navigationTitle("Causality SwiftUI")
            .onAppear {
                trackScreenView()
            }
            .overlay(
                toastOverlay
            )
        }
    }

    private var toastOverlay: some View {
        Group {
            if showToast {
                VStack {
                    Spacer()
                    Text(toastMessage)
                        .padding()
                        .background(Color.black.opacity(0.8))
                        .foregroundColor(.white)
                        .cornerRadius(10)
                        .padding(.bottom, 50)
                }
                .transition(.opacity)
                .animation(.easeInOut, value: showToast)
            }
        }
    }

    private func showToast(_ message: String) {
        toastMessage = message
        withAnimation {
            showToast = true
        }
        DispatchQueue.main.asyncAfter(deadline: .now() + 2) {
            withAnimation {
                showToast = false
            }
        }
    }

    private func trackScreenView() {
        Causality.shared.trackScreenView(name: "content_view")
        print("[SwiftUIExample] Screen view tracked: content_view")
    }

    private func trackEvent() {
        let event = EventBuilder(type: "button_tap")
            .property("button_name", "track_event")
            .property("screen", "content_view")
            .build()

        Causality.shared.track(event)
        print("[SwiftUIExample] Event tracked: button_tap")
        showToast("Event tracked!")
    }

    private func trackPurchase() {
        let event = EventBuilder(type: "purchase")
            .property("product_id", "pro-subscription")
            .property("price", 9.99)
            .property("currency", "USD")
            .property("quantity", 1)
            .build()

        Causality.shared.track(event)
        print("[SwiftUIExample] Event tracked: purchase")
        showToast("Purchase tracked!")
    }

    private func identifyUser() {
        do {
            try Causality.shared.identify(
                userId: "swiftui-user-456",
                traits: [
                    "name": AnyCodable("Jane Smith"),
                    "email": AnyCodable("jane@example.com"),
                    "premium": AnyCodable(true)
                ]
            )
            print("[SwiftUIExample] User identified")
            showToast("User identified!")
        } catch {
            print("[SwiftUIExample] Identify error: \(error)")
            showToast("Error: \(error.localizedDescription)")
        }
    }

    private func flushEvents() {
        isLoading = true
        Task {
            do {
                try await Causality.shared.flush()
                print("[SwiftUIExample] Events flushed")
                await MainActor.run {
                    isLoading = false
                    showToast("Events flushed!")
                }
            } catch {
                print("[SwiftUIExample] Flush error: \(error)")
                await MainActor.run {
                    isLoading = false
                    showToast("Error: \(error.localizedDescription)")
                }
            }
        }
    }

    private func resetUser() {
        do {
            try Causality.shared.reset()
            print("[SwiftUIExample] User reset")
            showToast("User reset!")
        } catch {
            print("[SwiftUIExample] Reset error: \(error)")
            showToast("Error: \(error.localizedDescription)")
        }
    }
}

#Preview {
    ContentView()
}
```

**sdk/ios/Examples/SwiftUIExample/SwiftUIExample/Info.plist:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>NSAppTransportSecurity</key>
    <dict>
        <key>NSAllowsLocalNetworking</key>
        <true/>
    </dict>
</dict>
</plist>
```

**sdk/ios/Examples/SwiftUIExample/README.md:**
```markdown
# Causality SwiftUI Example

This example demonstrates integrating the Causality SDK with a SwiftUI-based iOS app.

## Setup

1. Build the XCFramework:
   ```bash
   make mobile-ios
   ```

2. Open in Xcode or build with Swift Package Manager:
   ```bash
   cd sdk/ios/Examples/SwiftUIExample
   swift build
   ```

3. Update the API key and endpoint in `SwiftUIExampleApp.swift`

## Features Demonstrated

- SDK initialization in App struct init
- Screen view tracking on appear
- Custom event tracking with properties
- E-commerce purchase tracking
- User identification with traits
- Async flush with loading state
- User reset

## SwiftUI Patterns

### Initialization in App struct
```swift
@main
struct MyApp: App {
    init() {
        try? Causality.shared.initialize(config: Config(
            apiKey: "your-api-key",
            endpoint: "https://your-server.com",
            appId: "your-app-id"
        ))
    }
    // ...
}
```

### Track on View Appear
```swift
.onAppear {
    Causality.shared.trackScreenView(name: "home")
}
```

### Async Flush with Task
```swift
Task {
    try await Causality.shared.flush()
}
```
```
  </action>
  <verify>
    - Directory exists: `ls sdk/ios/Examples/SwiftUIExample/SwiftUIExample/`
    - README exists: `cat sdk/ios/Examples/SwiftUIExample/README.md`
  </verify>
  <done>
    - SwiftUI example with App struct initialization
    - ContentView with modern SwiftUI patterns
    - Demonstrates async/await flush
    - Toast overlay for feedback
    - README with setup instructions
  </done>
</task>

</tasks>

<verification>
- UIKit example: `ls sdk/ios/Examples/UIKitExample/UIKitExample/`
- SwiftUI example: `ls sdk/ios/Examples/SwiftUIExample/SwiftUIExample/`
- (Full build requires .xcframework from gomobile)
</verification>

<success_criteria>
- UIKit example demonstrates AppDelegate initialization
- SwiftUI example demonstrates App struct initialization
- Both examples show event tracking, identification, flush, reset
- Both examples have README with setup instructions
- Code follows platform idioms (UIKit with delegates, SwiftUI with @State)
</success_criteria>

<output>
After completion, create `.planning/phases/02-gomobile-sdk/02-09-SUMMARY.md`
</output>
